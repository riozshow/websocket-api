{"ast":null,"code":"import{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{Button,Progress,Alert}from'reactstrap';import{getSeats,loadSeatsRequest,loadSeats,getRequests}from'../../../redux/seatsRedux';import'./SeatChooser.scss';import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const REFRESH_RATE=2*60*1000;const SeatChooser=_ref=>{let{chosenDay,chosenSeat,updateSeat}=_ref;const dispatch=useDispatch();const seats=useSelector(getSeats);const requests=useSelector(getRequests);const[socket,setSocket]=useState();useEffect(()=>{const socket=io(process.env.NODE_ENV==='production'?'':'ws://localhost:8000',{transports:['websocket']});setSocket(socket);initSocket(socket);return()=>{socket.disconnect();};},[]);const initSocket=socket=>{socket.on('updateSeats',seats=>{dispatch(loadSeats(seats));});socket.emit('login');};const isTaken=seatId=>{return seats.some(item=>item.seat===seatId&&item.day===chosenDay);};const prepareSeat=seatId=>{if(seatId===chosenSeat)return/*#__PURE__*/_jsx(Button,{className:\"seats__seat\",color:\"primary\",children:seatId},seatId);else if(isTaken(seatId))return/*#__PURE__*/_jsx(Button,{className:\"seats__seat\",disabled:true,color:\"secondary\",children:seatId},seatId);else return/*#__PURE__*/_jsx(Button,{color:\"primary\",className:\"seats__seat\",outline:true,onClick:e=>updateSeat(e,seatId),children:seatId},seatId);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Pick a seat\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"small\",{id:\"pickHelp\",className:\"form-text text-muted ms-2\",children:[/*#__PURE__*/_jsx(Button,{color:\"secondary\"}),\" \\u2013 seat is already taken\"]}),/*#__PURE__*/_jsxs(\"small\",{id:\"pickHelpTwo\",className:\"form-text text-muted ms-2\",children:[/*#__PURE__*/_jsx(Button,{outline:true,color:\"primary\"}),\" \\u2013 it's empty\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"seats\",children:[...Array(50)].map((x,i)=>prepareSeat(i+1))}),/*#__PURE__*/_jsxs(\"p\",{className:\"opacity-75 p-2\",children:[\"Free seats: \",50-seats.length,\" / 50\"]}),requests['LOAD_SEATS']&&requests['LOAD_SEATS'].pending&&/*#__PURE__*/_jsx(Progress,{animated:true,color:\"primary\",value:50}),requests['LOAD_SEATS']&&requests['LOAD_SEATS'].error&&/*#__PURE__*/_jsx(Alert,{color:\"warning\",children:\"Couldn't load seats...\"})]});};export default SeatChooser;","map":{"version":3,"names":["useEffect","useState","useDispatch","useSelector","Button","Progress","Alert","getSeats","loadSeatsRequest","loadSeats","getRequests","io","jsx","_jsx","jsxs","_jsxs","REFRESH_RATE","SeatChooser","_ref","chosenDay","chosenSeat","updateSeat","dispatch","seats","requests","socket","setSocket","process","env","NODE_ENV","transports","initSocket","disconnect","on","emit","isTaken","seatId","some","item","seat","day","prepareSeat","className","color","children","disabled","outline","onClick","e","id","Array","map","x","i","length","pending","animated","value","error"],"sources":["D:/KODILLA/express-2/client/src/components/features/SeatChooser/SeatChooser.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Button, Progress, Alert } from 'reactstrap';\r\nimport {\r\n  getSeats,\r\n  loadSeatsRequest,\r\n  loadSeats,\r\n  getRequests,\r\n} from '../../../redux/seatsRedux';\r\nimport './SeatChooser.scss';\r\nimport io from 'socket.io-client';\r\n\r\nconst REFRESH_RATE = 2 * 60 * 1000;\r\n\r\nconst SeatChooser = ({ chosenDay, chosenSeat, updateSeat }) => {\r\n  const dispatch = useDispatch();\r\n  const seats = useSelector(getSeats);\r\n  const requests = useSelector(getRequests);\r\n\r\n  const [socket, setSocket] = useState();\r\n\r\n  useEffect(() => {\r\n    const socket = io(\r\n      process.env.NODE_ENV === 'production' ? '' : 'ws://localhost:8000',\r\n      { transports: ['websocket'] }\r\n    );\r\n    setSocket(socket);\r\n    initSocket(socket);\r\n\r\n    return () => {\r\n      socket.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  const initSocket = (socket) => {\r\n    socket.on('updateSeats', (seats) => {\r\n      dispatch(loadSeats(seats));\r\n    });\r\n    socket.emit('login');\r\n  };\r\n\r\n  const isTaken = (seatId) => {\r\n    return seats.some((item) => item.seat === seatId && item.day === chosenDay);\r\n  };\r\n\r\n  const prepareSeat = (seatId) => {\r\n    if (seatId === chosenSeat)\r\n      return (\r\n        <Button key={seatId} className='seats__seat' color='primary'>\r\n          {seatId}\r\n        </Button>\r\n      );\r\n    else if (isTaken(seatId))\r\n      return (\r\n        <Button key={seatId} className='seats__seat' disabled color='secondary'>\r\n          {seatId}\r\n        </Button>\r\n      );\r\n    else\r\n      return (\r\n        <Button\r\n          key={seatId}\r\n          color='primary'\r\n          className='seats__seat'\r\n          outline\r\n          onClick={(e) => updateSeat(e, seatId)}>\r\n          {seatId}\r\n        </Button>\r\n      );\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h3>Pick a seat</h3>\r\n      <div className='mb-4'>\r\n        <small id='pickHelp' className='form-text text-muted ms-2'>\r\n          <Button color='secondary' /> – seat is already taken\r\n        </small>\r\n        <small id='pickHelpTwo' className='form-text text-muted ms-2'>\r\n          <Button outline color='primary' /> – it's empty\r\n        </small>\r\n      </div>\r\n      <div className='seats'>\r\n        {[...Array(50)].map((x, i) => prepareSeat(i + 1))}\r\n      </div>\r\n      <p className='opacity-75 p-2'>Free seats: {50 - seats.length} / 50</p>\r\n      {requests['LOAD_SEATS'] && requests['LOAD_SEATS'].pending && (\r\n        <Progress animated color='primary' value={50} />\r\n      )}\r\n      {requests['LOAD_SEATS'] && requests['LOAD_SEATS'].error && (\r\n        <Alert color='warning'>Couldn't load seats...</Alert>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SeatChooser;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}